# Generated by Django 5.2.5 on 2025-08-25 09:25

from django.db import migrations
from datetime import date


def load_initial_data(apps, schema_editor):
    """Load initial data for the library app using migrations"""
    # Get model classes
    Author = apps.get_model('library', 'Author')
    Category = apps.get_model('library', 'Category')
    Book = apps.get_model('library', 'Book')
    
    # Create authors
    authors_data = [
        {
            'name': 'Terry Pratchett',
            'email': 'terry.pratchett@example.com',
            'birth_date': date(1948, 4, 28),
            'bio': 'English author of fantasy novels, especially comical works. He is best known for his Discworld series of 41 novels.'
        },
        {
            'name': 'Douglas Adams',
            'email': 'douglas.adams@example.com',
            'birth_date': date(1952, 3, 11),
            'bio': 'English author, screenwriter, essayist, humorist, satirist and dramatist. Adams is best known for The Hitchhiker\'s Guide to the Galaxy.'
        }
    ]
    
    created_authors = []
    for author_data in authors_data:
        author, created = Author.objects.get_or_create(
            name=author_data['name'],
            defaults=author_data
        )
        created_authors.append(author)
    
    # Create categories
    categories_data = [
        {
            'name': 'Comedy',
            'description': 'Humorous fiction designed to amuse and entertain readers.'
        },
        {
            'name': 'Satire',
            'description': 'Literature that uses humor, irony, exaggeration, or ridicule to expose and criticize people\'s vices or follies.'
        }
    ]
    
    created_categories = []
    for category_data in categories_data:
        category, created = Category.objects.get_or_create(
            name=category_data['name'],
            defaults=category_data
        )
        created_categories.append(category)
    
    # Create books
    books_data = [
        {
            'title': 'The Color of Magic',
            'author': created_authors[0],  # Terry Pratchett
            'category': created_categories[0],  # Comedy
            'publication_date': date(1983, 11, 24),
            'pages': 288,
            'isbn': '9780552124751',
            'price': 16.99,
            'is_available': True
        },
        {
            'title': 'The Hitchhiker\'s Guide to the Galaxy',
            'author': created_authors[1],  # Douglas Adams
            'category': created_categories[1],  # Satire
            'publication_date': date(1979, 10, 12),
            'pages': 224,
            'isbn': '9780345391803',
            'price': 15.99,
            'is_available': True
        }
    ]
    
    for book_data in books_data:
        Book.objects.get_or_create(
            title=book_data['title'],
            defaults=book_data
        )


def reverse_initial_data(apps, schema_editor):
    """Remove initial data (for migration rollback)"""
    Author = apps.get_model('library', 'Author')
    Category = apps.get_model('library', 'Category')
    Book = apps.get_model('library', 'Book')
    
    # Remove books first (due to foreign key constraints)
    Book.objects.filter(title__in=[
        'The Color of Magic',
        'The Hitchhiker\'s Guide to the Galaxy'
    ]).delete()
    
    # Remove authors and categories
    Author.objects.filter(name__in=['Terry Pratchett', 'Douglas Adams']).delete()
    Category.objects.filter(name__in=['Comedy', 'Satire']).delete()


class Migration(migrations.Migration):

    dependencies = [
        ('library', '0002_auto_20250825_1614'),
    ]

    operations = [
        migrations.RunPython(
            load_initial_data,
            reverse_initial_data,
            hints={'target_db': 'default'}
        ),
    ]
